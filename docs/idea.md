# 題目（含一句話摘要）

**藥材影像的特徵流形一致性：在 NB-TCM-CHM 上以幾何正則化學習跨來源穩健表徵**
一句話：只用 NB-TCM-CHM（含網路蒐集與手機實拍兩個來源）來驗證一個「**流形一致性正則化**」(Manifold Consistency Regularization, MCR) 的想法：讓同一藥材在不同來源上的特徵位於**相同的內在流形**，並以幾何指標（而非 SOTA 排行）衡量學習是否成功。NB-TCM-CHM 提供 20 類藥材果實影像，Dataset-1 含 3,384 張網路圖、Dataset-2 含 400 張手機實拍圖，且均由中醫藥專家標註，非常適合做跨來源幾何分析。([PubMed][1])

---

## 研究核心問題

在 **僅使用 NB-TCM-CHM** 的前提下，如何學得一個影像表徵，使得：

1. **同一藥材**於不同影像來源（web vs. phone）落在**相同/對齊的低維流形**上；
2. **不同藥材**的流形在幾何上**可分**（如以測地距離分離）？
   我們關心的是表徵的**內在幾何品質**，非排行榜式準確率比較。關鍵動機是：流形學習能揭示資料的低維幾何結構並輔助可視化與去雜訊，這比單純壓低錯誤率更能提供可解釋的洞見。([年刊評論][2])

## 研究目標

1. 提出 **MCR 損失**：鼓勵**來源內一致性**與**跨來源對齊**的測地幾何保持。
2. 建立一套**幾何評估指標**（流形維度估計、信賴度/連續性、測地扭曲、流形曲率與可分性指標），作為是否「學到內在流形」的**主要成效指標**。
3. 證明在合理幾何條件下，MCR 可以**保留類別間的測地間隔（margin）**，使得簡單分類器（如 1-NN/k-NN）在跨來源下仍具穩健性。
4. 提供**可重現**的 NB-TCM-CHM 幾何實驗流程，後續可給其他 TCM 視覺任務沿用。

## 預期貢獻

* **方法面**：提出一個**幾何正則化**框架（MCR），專注學習**來源不變的特徵流形**。
* **評估面**：用**幾何品質指標**取代 SOTA 排行，建立可重複、可診斷的流形評測協議。
* **理論面**：給出「**低扭曲-高間隔** ⇒ **穩健可分**」的邏輯鏈。
* **資料面**：示範 NB-TCM-CHM 的**跨來源**價值（Dataset-1: 網路 3,384 張；Dataset-2: 手機 400 張；合計 20 類果實藥材）與幾何分析可行性。([PubMed][1])

## 創新

* 從「**內在幾何**」角度切入 CHM 影像辨識：不是追求 SOTA，而是回答**特徵空間是否學到正確的流形結構**。
* **只用單一資料集**完成**跨來源**（web→phone）對齊與穩健性檢驗，避免額外外部數據。([PubMed][1])
* 將**流形學習與度量學習**（測地距離保持、Laplace-Beltrami 近似）系統化引入中藥材影像。([年刊評論][2])

## 理論洞見（直觀）

* 若每個類別 (c) 的影像分布近似位於一個低維流形 (\mathcal{M}_c)，且跨來源只是**在同一流形上的不同取樣**（光照、視角、噪聲造成的「位移」），那麼理想的表徵 (f) 應是近似**等距/雙李普希茲**嵌入，使 (\mathcal{M}_c) 在特徵空間保持幾何不變（如測地距離與局部鄰域結構）。這與流形學習文獻「學得可解釋的低維結構」的精神一致。([年刊評論][2])

---

## 方法論（可直接落地）

**資料**：NB-TCM-CHM 全部 20 類；訓練主要用 Dataset-1（3,384），測試與對齊檢驗用 Dataset-2（400）。([PubMed][1])

Backbone: ResNet-18 / denseNet-121 / deit_tiny_patch16_224 / convnextv2_atto / vit_tiny_patch16_224

**(A) 表徵學習骨架（自監督）**

* Backbone：小型 CNN 或 ViT-tiny（避免過參數），僅在 NB-TCM-CHM 上做 SimCLR/DINO 式對比學習；增強只用旋轉、裁切、亮度/對比/色溫，避免語義破壞。
* 取出倒數幾層做投影頭，得到特徵 (z=f_\theta(x))。

**(B) 流形一致性正則（MCR）**

1. **來源內測地保持**：對 Dataset-1（或 Dataset-2）建 (k)-NN 圖估計測地距離 (\hat d_{\text{geo}}(x_i,x_j))；在特徵空間以圖-最短路徑近似 (d_{\text{geo}}(z_i,z_j))。
   [
   \mathcal{L}*{\text{intra}}=\sum*{(i,j)\in\mathcal{N}} \Big(d_{\text{geo}}(z_i,z_j)-\hat d_{\text{geo}}(x_i,x_j)\Big)^2
   ]
2. **跨來源等距對齊**：對同類藥材在兩來源的鄰對 ((x^A,x^B)) 施加
   [
   \mathcal{L}*{\text{cross}}=\sum \big|,\mathrm{Exp}*{z^A}(\Delta^A)-\mathrm{Exp}_{z^B}(\Delta^B)\big|^2
   ]
   其中 (\mathrm{Exp}) 代表在特徵流形上之指數映射（實作用圖-測地近似），(\Delta^\cdot) 由局部鄰域圖構成的「切向位移」。直覺：**同一類**在兩來源的**局部幾何應可對齊**。
3. **分類頭（可選，僅作診斷）**：凍結 (f_\theta) 後，以簡單 **k-NN / 線性分類器**評估類別可分性，不以此與 SOTA 比拼。
4. **總損失**：(\mathcal{L}=\mathcal{L}*{\text{SSL}}+\lambda_1\mathcal{L}*{\text{intra}}+\lambda_2\mathcal{L}_{\text{cross}})。

**(C) 幾何評估指標（主報告指標）**

* **Trustworthiness / Continuity（T&C）**、**Geodesic Distortion（測地扭曲）**、**Local Intrinsic Dim.（內在維度）**、**離群曲率比例**、**類間測地間隔**。這些反映是否真學到低維幾何結構，而非僅僅擬合分類器。流形學習的統計基礎與常見作法可見近期綜述。([年刊評論][2])

---

## 數學理論推演與（證明綱要）

設每個類別 (c) 的真實資料位於緊緻、連通的黎曼流形 ((\mathcal{M}*c,g_c))，且**類間最小測地間隔**為 (\Delta=\min*{c\neq c'}\min_{x\in\mathcal{M}*c,y\in\mathcal{M}*{c'}} d_{g}(x,y))。令學得之嵌入 (f:\cup_c\mathcal{M}_c\to\mathbb{R}^d) 為雙李普希茲，扭曲常數 (\epsilon) 滿足
[
(1-\epsilon),d_g(x,y)\le |f(x)-f(y)|\le (1+\epsilon),d_g(x,y)
]
且各 (\mathcal{M}*c) 的有界**主曲率** (\kappa) 與**注入半徑** (r*{\text{inj}}) 滿足標準估計假設（確保以 (k)-NN 圖近似測地距離的誤差受控）。則：

**命題 1（間隔保存）**：若 (\epsilon<\frac{1}{3}) 且估計誤差 (\delta) 足夠小，則嵌入後的**類間歐式間隔**至少為 ((1-2\epsilon)\Delta - O(\delta))。
**命題 2（k-NN 可分）**：在樣本密度充分且 (\epsilon,\delta) 受控時，**1-NN/k-NN** 在特徵空間的跨來源錯誤率上界由 (\exp(-c,\Delta^2)) 型的項支配（(c) 與曲率/維度/覆蓋數有關）。
**命題 3（跨來源等距對齊 ⇒ 等幾何）**：若 (\mathcal{L}_{\text{cross}}\to 0)，則對同一類別兩來源取樣之嵌入，存在局部同胚 (\phi) 使鄰域內測地保距（至一階），故兩者**局部等幾何**。

*證明思路*：使用流形正則化與圖拉普拉斯逼近 ( \Delta_{\mathcal{M}} ) 的既有一致性結果，以及雙李普希茲嵌入維持間隔與鄰域排序的性質；圖最短路徑近似測地距離的誤差由取樣密度、鄰數 (k) 與曲率控制。相關理論背景可見流形正則化與拉普拉斯嵌入收斂等經典與近期綜述。([年刊評論][2])

---

## 預計使用資料集（only NB-TCM-CHM）

* **Dataset-1**：20 類、3,384 張，來源為網路蒐集；
* **Dataset-2**：20 類、400 張，來源為傳統中醫藥房手機拍攝；
* 皆由**中醫藥專家標註**，每類各自成資料夾。**本研究不使用其他外部資料**。([PubMed][1])

---

## 與現有研究之區別

* 既有 CHM 影像工作多以**分類準確率**與**模型改進**為重心（且常用自建數據），NB-TCM-CHM 的建立則補足公共數據來源；我們的重點改為**幾何結構的學與評**。([PubMed][1])
* 流形學習文獻強調低維結構有助可視化與可解釋，我們將此**落地到 CHM** 的跨來源一致性，並以**幾何指標**而非 SOTA 排位為主報告。([年刊評論][2])

---

## Experiment 設計（只做內部對照，不與 SOTA 比）

**E0. 基線與分割**

* Train：Dataset-1；Val/Test-A：Dataset-1；Test-B：Dataset-2（跨來源）。

**E1. 幾何診斷（無分類器）**

* 比較：w/o MCR（只有自監督） vs. w/ MCR。
* 指標：T&C、Geodesic Distortion、Local ID（如 MLE/Two-NN）、局部曲率估計、類間測地間隔；並以 2D/3D 嵌入（Diffusion Maps/Laplacian Eigenmaps）作可視化與鄰域保存量化。([年刊評論][2])

**E2. 跨來源對齊**

* 在 Test-B 檢查同類在兩來源的**鄰域重疊率**、**局部等距誤差**、**子流形主角距**。
* 以**來源辨識器**（判別 web 或 phone）作「反指標」：越難分辨來源，表示越好的一致性（但不作主指標）。

**E3. 小樣本可分性**

* 凍結表徵，以 **k-NN / 線性分類器**在 Test-B 作**少量標註**（每類 1–5 張）學習，觀察性能隨標註量的**資料效率曲線**。
* 目的不是拿最高分，而是對照 w/o MCR 的**資料效率改善**。

**E4. 消融**

* (\lambda_1,\lambda_2) 權重掃描；鄰數 (k) 與圖構造（(\epsilon)-graph vs. k-NN）；不同自監督頭（SimCLR vs. DINO）。
* 檢查指標敏感度與穩定性，並通過**統計顯著性**（如 bootstrap 信賴區間）回報。

**報告格式**

* 主要圖表：幾何指標對照條圖／折線、跨來源嵌入可視化、資料效率曲線；
* 附錄：理論假設、界與證明細節、實作參數與重現指引。